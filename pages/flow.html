<!DOCTYPE html>
<html>
  <head>
    <title>Better Luck Next Time!</title>
    <link rel="stylesheet" href="./css/flowPage.css"/>
  </head>
  <body>
    <object type="image/svg+xml" data="./images/svg/flowchart.svg" id=svg_render></object>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();

      window.onload = () => {
        socket.on("colourUpdate", (objectID, colour) => {
          const selectedShape = document.getElementById("svg_render").contentDocument.documentElement.getElementById(objectID)

          if (selectedShape) {
            selectedShape.style["transition"] = "0.5s"
            selectedShape.style["fill"] = colour
          }
        })

        socket.on("overlayUpdate", (text) => {
          const textOverlay = document.getElementById("svg_render").contentDocument.documentElement.getElementById("overlayText");

          if(textOverlay) {
            changeText(textOverlay, text)
          }
        })
    }

    //https://stackoverflow.com/questions/63980077/animate-text-content-with-js
    var changeText = function(textObject, newText) {
        item = textObject
        
        // item.animate(...) returns an Animation (refer to https://developer.mozilla.org/en-US/docs/Web/API/Element/animate)
        let animation = item.animate([
            // keyframes
            { opacity: '1' },
            { opacity: '0.9' },
            { opacity: '0.4' },
            { opacity: '0.1'},   
            { opacity: '0.0' }
            
          ], { 
            // timing options
            duration: 500,
            });
          
          /* The Animation has an eventHandler 
            refer to here: https://developer.mozilla.org/en-US/docs/Web/API/Animation
            and here: https://developer.mozilla.org/en-US/docs/Web/API/Animation/onfinish
          */
          animation.onfinish = function() {
            // change text 
            item.children[0].textContent = newText;
            // and start the second animation   
            item.animate([
            // keyframes
            { opacity: '0.0' },
            { opacity: '0.1' },
            { opacity: '0.4' },
            { opacity: '0.9'},   
            { opacity: '1' }
            
          ], { 
            // timing options
            duration: 500,
            
          });
        };
      }
    </script>
  </body>
</html>